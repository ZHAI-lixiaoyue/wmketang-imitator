angular.controllers.controller("examListCtrl",["request","$scope","user","$timeout","$request","$ionicScrollDelegate","$state","examSystem","prompt","$ionicSlideBoxDelegate","$ionicPlatform","$ionicHistory",function(t,e,i,a,n,s,o,r,c,l,m,d){var u,p;e.isOpenTms=!0,e.$on("$ionicView.afterEnter",(function(){u=m.registerBackButtonAction((function(t){t.preventDefault(),e.back()}),101)})),e.$on("$ionicView.afterLeave",(function(){u()})),e.types=[{name:"全部考试",id:0},{name:"周考",id:1},{name:"月考",id:2},{name:"单元考",id:3},{name:"期中",id:4},{name:"期末",id:5},{name:"学业水平模拟考试",id:6},{name:"升学模拟考试",id:7},{name:"联考",id:8}],e.currentType=e.types[0],n.jsonp("exam/getGradeList",{_host:appConf.TMS_HOST,access:1},(function(t){t.data?(p=[],angular.forEach(t.data.list,(function(t){p.push(t.id)}))):e.dataNone=!0,e.terms&&p&&(e.isLoaded=!0,l.enableSlide(!1))}),(function(t){e.dataError=!0,c.showTip(t.msg)})),n.jsonp("exam/getTermList",{_host:appConf.TMS_HOST,access:1},(function(t){if(t.data){e.isLoaded=!0;var i=new Date(t.systime).getTime();e.isOpenTms=t.data.isOpenTms,e.terms=[],angular.forEach(t.data.list,(function(t){Number(t.begin)<i&&e.terms.push(t)})),0==e.terms.length&&(e.terms=[{title:"暂无",id:0}]),e.currentTerm={title:e.terms[0].title,id:e.terms[0].id},angular.forEach(e.terms,(function(t){1==t.current&&(e.currentTerm={title:t.title,id:t.id})})),e.examList={},e.examList[e.currentType.id]={},e.examList[e.currentType.id][e.currentTerm.id]={list:[],hasData:!0,total:null,doingList:[],hasDoingData:!0}}else e.dataNone=!0;e.terms&&p&&(e.isLoaded=!0,l.enableSlide(!1))}),(function(t){e.dataError=!0,c.showTip(t.msg)})),e.title="已结束的考试",e.tab=0,e.isShow={type:!1,term:!1},e.toggleChoice=function(t){e.isShow.type=0==t&&!e.isShow.type,e.isShow.term=1==t&&!e.isShow.term},e.choiceType=function(t){e.toggleChoice(0),e.currentType=e.types[t],s.scrollTop(),e.examList[e.currentType.id]||(e.examList[e.currentType.id]={},e.examList[e.currentType.id][e.currentTerm.id]={list:[],hasData:!0,total:null,doingList:[],hasDoingData:!0})},e.choiceTerm=function(t,i){e.toggleChoice(1),e.currentTerm={title:t,id:i},s.scrollTop(),e.examList[e.currentType.id][e.currentTerm.id]||(e.examList[e.currentType.id][e.currentTerm.id]={list:[],hasData:!0,total:null,doingList:[],hasDoingData:!0})},e.getTests=function(t){var a=e.currentType.id,s=e.currentTerm.id,o={_host:appConf.TMS_HOST,access:1,year:i.user.childS.ktinfo.userYear,schoolTypeID:i.user.childS.ktinfo.schoolTypeID,termID:s,status:t,len:10,totalInt:1};o.start=2==t?e.examList[a][s].doingList.length:e.examList[a][s].list.length,a&&(o.typeID=a),e.terms&&p?n.jsonp("exam/getExaminationList",o,(function(i){i.data&&(3==t?(e.examList[a][s].backTotal=i.data.total,e.examList[a][s].list=e.examList[a][s].list.concat(i.data.examinationList),0==e.examList[a][s].doingList.length&&e.getTests(2)):(e.examList[a][s].total=i.data.total,e.examList[a][s].doingList=e.examList[a][s].doingList.concat(i.data.examinationList))),(!i.data||i.data.examinationList.length<10)&&(3==t?e.examList[a][s].hasData=!1:e.examList[a][s].hasDoingData=!1),e.$broadcast("scroll.infiniteScrollComplete")}),(function(i){3==t?e.examList[a][s].hasData=!1:e.examList[a][s].hasDoingData=!1,e.$broadcast("scroll.infiniteScrollComplete"),c.showTip(i.msg)})):e.$broadcast("scroll.infiniteScrollComplete")},e.toTesting=function(){e.tab=1,e.title="正在进行的考试"},e.toExamInfo=function(i){t.jsonp("news/readMsgByParams",{_host:appConf.XTDA_HOST,childID:e.user.childS.ktinfo.uid,subTypeID:10205,examinationID:i.id,ssk:angular.services.ssk},(function(){}),(function(t){prompt.showTip(t.msg)})),o.go("main.examInfo",{uid:e.uid,title:i.title,examinationID:i.id,status:status}),r.examInfo=i},e.back=function(){e.tab?a((function(){e.tab=0,e.title="已结束的考试"}),0):d.goBack()}}]);