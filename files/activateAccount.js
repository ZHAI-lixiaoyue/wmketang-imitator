angular.services.factory("activateAccount",["$ionicModal","$ionicPlatform","systemFactory","$rootScope","$ionicPopup","user","prompt","$timeout","$state","$ionicLoading","requestTF","requestP",function(t,n,o,i,s,e,c,a,u,f,p,r){var d={};return{showActivate:function(t,o){var a=t.info,f=function(t,o,e,c,a,u,f){var p;u&&(p=n.registerBackButtonAction((function(t){}),401));var r=0,d=s.show({cssClass:f?"activeBox-confirm":"activeBox",template:'<div class="fl" style="width: 100%;"><p class="fl tc f16" style="width: 100%; background: none;padding: 0 10px; border-bottom: 1px solid #f2f2f2;">'+t+"</p></div>",buttons:[{text:c||"取消",type:"kt-box-pointBtn active-button-cancel",onTap:function(){a&&a(),p&&p()}},{text:e||"确定",type:"kt-box-pointBtn active-button-sure",onTap:function(){1==(r+=1)&&(o&&o(),p&&p())}}]});$(document).find(".popup-head").remove(),i.dialog_close=function(){d.close()}};function l(){if(parseInt(a.ktinfo.status))return!1;f("<p class='tc mb10'>请您为孩子激活账号，孩子即可使用课堂或学习空间，你即可了解孩子学情</p><p class='tc mb10' style='color: #999; font-size: 12px;'>（未激活的孩子账号无法使用课堂或学习空间）</p><p class='tc mb10' style='color: #666;'>"+a.uname+"（"+i.handleStr(a.account,2)+"）</p>",(function(){p.post("user/activeChild",{_host:t.info.ktinfo.host+"/index.php?r=dsapi/",pid:returnRsa(e.user.info.uid),ssk:a.ktinfo.ssk},(function(i){var e,c,p,r,d;0==i.status&&(o&&o(),a.ktinfo.activeStatus=1,1==a.ktinfo.isUpdatePwd?(e="<span class='tc fl w'>恭喜您，孩子账号激活成功！</span><span class='tc fl w'>孩子可以在学生端登录使用智慧教学平台或学习空间了</span>",c=function(){},p="知道了",r&&(d=n.registerBackButtonAction((function(t){}),401)),s.show({template:'<div class="fl" style="width: 100%;"><p class="fl tc f16" style="width: 100%; background: none;padding: 0 10px; border-bottom: 1px solid #f2f2f2;">'+e+"</p></div>",cssClass:"activeBox-alert",buttons:[{text:p||"确定",type:"active-button-sure",onTap:function(){c&&c()}}]}).then((function(){d&&d()})),$(document).find(".popup-head").remove()):f("<p class='tc mb10'>恭喜您，孩子账号激活成功！</p><p class='tc mb10'>请孩子在学生端使用学校安全密码登录；或者帮孩子设置登录密码，孩子使用新密码登录教学平台</p>",(function(){u.go("main.resetChildrenPwd",{index:t.index})}),"设置孩子登录密码","关闭",(function(){}),!1,!0))}),(function(t){c.showTip(t.msg)}))}),"确定激活","暂不激活",(function(){d[t.info.ktinfo.uid]=!0}))}a.ktinfo.ssk?l():r.jsonp("user/GetKtUserInfoBySSK",{ssk:a.ssk},(function(n){n.data&&(0==n.data.isNeedActive&&(n.data.activeStatus=1),e.user.info.children[t.index].ktinfo=n.data,e.user.info.children[t.index].ktInfoLoaded=!0,e.saveUser(),l())}),(function(t){c.showTip(t.msg)}))},needActivate:function(t){return!(!t.ktinfo||0!=t.ktinfo.activeStatus||d[t.ktinfo.uid])}}}]);