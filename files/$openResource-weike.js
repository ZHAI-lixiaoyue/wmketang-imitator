angular.services.factory("$openResourceWeike",["$request","$ionicModal","$ionicPlatform","$ionicScrollDelegate","$prompt","$timeout",function(e,i,o,s,t,r){return function(n,u){var c=!0,l=n.scope||{};l.isAndroid=!(!ionic.Platform.isAndroid()||!window.cordova),l._item=n.type&&n,l.weikeTitle="";var a=(new Date).getTime();l.setFavorite=function(){var i=l._item;l.isSetting=!0,e.jsonp("resource/favorite",{type:i.type,id:i.id,action:i.isfavorite?2:1},(function(e){i.isfavorite=i.isfavorite?0:1,l.isSetting=!1,t.showTip(e.msg)}),(function(e){l.isSetting=!1,t.showTip(e.msg)}))};var w,p=o.registerBackButtonAction((function(){l.closeWeike()}),550);function f(e,i){var o=document.createElement("DIV");o.innerHTML=e,window.plugins&&window.plugins.videoPlayPlugin.play({isFullScreen:!0,autoPlay:!0,videos:[{title:o.innerText,size:"22",duration:0,url:i}]})}l.closeWeike=function(){p&&p(),l.weikeModal.remove()},l.selectWeike=function(i,o,s,r){l.weikeUrl=i,l.weikeTitle=o,l.isAndroid&&f(o,i),e.jsonp("resource/play",{typeID:u.type,resourceID:u.id,_host:appConf.host+"r=tsapi/"},(function(e){}),(function(e){t.showTip(e.msg)})),e.jsonp("resource/play",{typeID:l.course.list[s].subSections[r].typeID,resourceID:l.course.list[s].subSections[r].id,_host:appConf.host+"r=tsapi/"},(function(e){}),(function(e){t.showTip(e.msg)}))},l.toggleItem=function(e){l.course.list[e].show=!l.course.list[e].show,s.resize()},u&&u.swlid?(w=navigator.userAgent,l.sewiseItem=u,i.fromTemplateUrl("js/services/sewiseSPlayer.html",angular.extend({animation:"slide-in-right",hardwareBackButtonClose:!1},n)).then((function(e){e.show(),l.weikeModal=e,new SewiseSPlayer("#sewisePlayer",{host:l.sewiseItem.host,swlid:l.sewiseItem.swlid,uname:l.sewiseItem.uname,moblieOpenQueation:!0}),setTimeout((function(){navigator.__defineGetter__("userAgent",(function(){return w}))}),1e4)}))):function(){n.course?(l.course=n.course,angular.forEach(l.course.list,(function(e,i){l.course.list[i].show=!i})),l.weikeUrl=l.course.list[0].weike[0].url,l.weikeTitle=l.course.list[0].weike[0].title,l.isAndroid&&window.plugins&&window.plugins.videoPlayPlugin.play({isFullScreen:!0,autoPlay:!0,videos:[{title:l.weikeTitle,size:"22",duration:0,url:l.weikeUrl}]})):85==u.type?e.jsonp("topTeacherCourse/getCourseWeikes",{_host:appConf.host+"r=repositories/",courseID:n.courseId},(function(i){var o;if(l.course={list:[]},l.course.list=i.data,angular.forEach(l.course.list,(function(e,i){l.course.list[i].show=!1})),n.weiKeId)for(var w=0;w<l.course.list.length;w++)for(var p=l.course.list[w].subSections,d=0;d<p.length;d++){var h=p[d];if(h.id==n.weiKeId){if(o=h,l.course.list[w].show=!0,s.resize(),l.isAndroid){var g=300-((new Date).getTime()-a);r((function(){f(o.title,o.url)}),g>0?g:0)}break}}o||(o=l.course.list[0].subSections[0],l.course.list[0].show=!0,s.resize()),l.weikeUrl=o.url,l.weikeTitle=o.title,c&&(e.jsonp("resource/play",{typeID:u.type,resourceID:n.courseId,_host:appConf.host+"r=tsapi/"},(function(e){c=!1}),(function(e){t.showTip(e.msg)})),e.jsonp("resource/play",{typeID:o.typeID,resourceID:o.id,_host:appConf.host+"r=tsapi/"},(function(e){c=!1}),(function(e){t.showTip(e.msg)})))}),(function(e){t.showTip(e.msg)})):e.jsonp("resource/getCourse",{courseId:n.courseId},(function(e){l.course=e.data.course,angular.forEach(l.course.list,(function(e,i){l.course.list[i].show=!i})),l.weikeUrl=l.course.list[0].weike[0].url,l.weikeTitle=l.course.list[0].weike[0].title}),(function(){}));i.fromTemplateUrl("js/services/weike.html",angular.extend({animation:"slide-in-right"},n)).then((function(e){e.show(),l.weikeModal=e}))}()}}]);