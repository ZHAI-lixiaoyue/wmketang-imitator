angular.controllers.controller("messageCtrl",["$scope","$rootScope","user","$state","$ionicHistory","request","$timeout","$ionicScrollDelegate","prompt","$class","mySocket",function(e,s,a,o,t,n,r,i,c,l,m){e.user=a.user,e.userType=a.userType,e.ktChild=[],e.goDetail=function(s){s!=e.user.info.id&&s&&o.go("main.contactDetail",{uid:s})},a.user.info.children&&angular.forEach(a.user.info.children,(function(s){s.ktinfo&&(e.ktChild.push(s),n.jsonp("class/getList",{uid:s.ktinfo.uid},(function(e){s.class=e.data.class}),(function(){c.showTip("获取老师信息列表失败")})),s.ktinfo.name=s.uname,s.ktinfo.portraits=s.ktinfo.portrait,s.ktinfo.type=1,l.friends[s.ktinfo.uid]||(l.friends[s.ktinfo.uid]=s.ktinfo))})),e.teachers={},e.getTeachers=function(s){l.getMembers({classid:s,type:2},(function(a){e.teachers[s]=a.data.member,r((function(){i.resize()}),200)}),(function(e){c.showTip(e.msg)}))},e.goWeekPerform=function(e){e.preventDefault();var s=childS;s&&s.ktinfo?o.go("main.weekPerform",{uid:s.ktinfo.uid}):c.showTip("当前孩子没有关联课堂账号！")},e.homeMessage.home={},s.loadHomePage=function(){var s=0,a=0;n.jsonp("message/homePage",{ssk:angular.services.ssk},(function(o){s++,e.homeMessage.home.appraise=o.data.appraise,e.homeMessage.home.systemMsg=o.data.systemMsg,o.data.systemMsg&&(a+=o.data.systemMsg.unreadCount),o.data.appraise&&(a+=o.data.appraise.unreadCount),3==s&&(e.homeMessage.messageTotal=a,e.$broadcast("scroll.refreshComplete"))}),(function(){3==++s&&(e.homeMessage.messageTotal=a,e.$broadcast("scroll.refreshComplete"))})),n.jsonp("message/homePage",{ssk:angular.services.ssk},(function(o){s++,e.homeMessage.home.classMsg=o.data.classMsg,o.data.classMsg&&(a+=o.data.classMsg.unreadCount),3==s&&(e.homeMessage.messageTotal=a,e.$broadcast("scroll.refreshComplete"))}),(function(){3==++s&&(e.homeMessage.messageTotal=a,e.$broadcast("scroll.refreshComplete"))})),n.jsonp("message/list",{ssk:angular.services.ssk},(function(o){e.homeMessage.chatList=o.data.list||[],a+=o.data.unreadtotal,3==++s&&(e.homeMessage.messageTotal=a,e.$broadcast("scroll.refreshComplete"))}),(function(){3==++s&&(e.homeMessage.messageTotal=a,e.$broadcast("scroll.refreshComplete"))}))},s.loadHomePage();var u=0;m.on("connect",(function(){a.user.info&&(u&&s.loadHomePage(),u++)})),m.on("Ketang_APP",s.loadHomePage)}]);