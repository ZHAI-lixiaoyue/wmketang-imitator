angular.controllers.controller("examInfoCtrl",["$ionicSlideBoxDelegate","$timeout","user","$scope","$stateParams","$state","examSystem","$request","prompt",function(t,e,a,i,n,o,s,c,d){i.title=n.title||"",i.uid=n.uid,i.studentTotal=0,i.tab=0,c.jsonp("exam/getExaminationInfo",{_host:appConf.TMS_HOST,uid:i.uid,access:1,examinationID:n.examinationID},(function(a){a.data&&(i.title||(i.title=1==a.data.status?"系统消息":a.data.title),i.examInfo=a.data),i.examInfo&&i.achievementList&&i.testClassList&&(i.isLoaded=!0,e((function(){t.$getByHandle("examInfo").enableSlide(!1)}),500))}),(function(t){d.showTip(t.msg),i.dataError=!0})),c.jsonp("exam/getExaminationRecordList",{_host:appConf.TMS_HOST,uid:i.uid,access:1,examinationID:n.examinationID},(function(a){var n="";a.data.recordList.forEach((function(t){n+=t.id+","})),a.data&&c.jsonp("exam/studentExaminationSubmitViewAuth",{_host:appConf.TMS_HOST,examinationRecordID:n},(function(n){console.log(i.user.info),a.data.recordList.forEach((function(t){t.publicUserTypeObject&&t.publicUserTypeObject.forEach((function(e){console.log(e,i.user.info.utype),3==e.userTypeID&&(t.openStatus=e.status)})),n.data.list.forEach((function(e){t.id==e.examinationRecordID&&e.correctStatus&&(t.correctStatus=e.correctStatus,t.myScore=e.score)}))})),i.achievementList=a.data.recordList,i.examInfo&&i.achievementList&&i.testClassList&&(i.isLoaded=!0,e((function(){t.$getByHandle("examInfo").enableSlide(!1)}),500))}),(function(t){d.showTip(t.msg),i.dataError=!0}))}),(function(t){d.showTip(t.msg),i.dataError=!0})),c.jsonp("exam/getExamineeClassList",{_host:appConf.TMS_HOST,access:1,uid:i.uid,examinationID:n.examinationID},(function(a){a.data&&(i.testClassList=a.data.classList,angular.forEach(i.testClassList,(function(t){i.studentTotal+=t.total}))),i.examInfo&&i.achievementList&&i.testClassList&&(i.isLoaded=!0,e((function(){t.$getByHandle("examInfo").enableSlide(!1)}),500))}),(function(t){d.showTip(t.msg),i.dataError=!0})),i.submitExam=function(t){d.loading.show();var e={_host:appConf.host+"r=",aeid:t.aeid};c.jsonp("submitExam/getRecentAnswer",e,(function(e){e.data||(e.data={app:appConf.appKey,exam:{examID:t.examID,answerExamID:t.aeid,submit:(new Date).getTime(),exercises:[]},save:1,ssk:angular.services.ssk,examinationRecordID:t.id,used:0,sceneID:5}),e.data.save=1;var a="sjob/submitExam2",n={data:JSON.stringify(e.data)};examService.getHost((function(){var t=examService.serverHost;t&&t.exSubmitHost&&(a="/ae/submit?",n._host=t.exSubmitHost),c.post(a,n,(function(){d.loading.hide(),d.showTip("试卷提交成功！"),i.pageReload()}),(function(t){d.loading.hide(),d.showTip("提交失败！")}))}),(function(){d.loading.hide(),d.showTip("提交失败！")}))}),(function(t){d.loading.hide(),d.showTip("提交失败！")}))},i.selectTab=function(t){i.tab=t},i.toAnswerResult=function(t){function e(){o.go("main.testResults",{aeid:t.aeid,title:t.title,sceneID:5,hideAnswer:!0})}4==t.answerExamStatus?(d.loading.show(),$requestCB.jsonp("answerExam/getAeStatus",{aeid:t.aeid},(function(t){1==t.data.aeStatus?e():d.showTip("答案提交中，请稍后查看"),d.loading.hide()}),(function(t){d.showTip(t.msg),d.loading.hide()}))):e()},i.toResult=function(t,e){e.publicUserTypeMap.indexOf("3")+1&&(0==e.correctStatus||e.aeid?!e.myScore&&e.correctStatus||0==e.correctStatus?t.preventDefault():o.go("main.testResults",{aeid:e.aeid,title:e.title,examinationRecordID:e.id,sceneID:5,openStatus:e.openStatus}):d.showTip("您未提交试卷"))},i.tips=function(t){d.showTip(t)}}]);