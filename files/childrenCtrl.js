angular.controllers.controller("childrenCtrl",["request","data","$rootScope","$timeout","$location","$ionicScrollDelegate","$interval","$scope","user","$state","prompt","routeHistory","requestTF","lokiService","appState","camera","openResource","requestP","$ocLazyLoad",function(e,o,i,t,n,s,a,r,c,u,l,d,p,g,m,h,f,k,w){r.user=c.user,r.$on("enter.home",(function(){r.hideSlide=!0,t((function(){r.hideSlide=!1}),80)})),r.indexScan=function(){r.scan()},r.sliderOptions={loop:!0,effect:"swipe",speed:500,shortSwipes:!0,pagination:".custom-swiper-pagination",paginationClickable:!0,shortSwipesRatio:.9},r.scan=function(){function i(i){p.jsonp("scan/parentScanQrcode",{_host:appConf.XT_HOST,code:encodeURI(i)},(function(e){if(27==e.data.rtype){var o=e.data.course||[];o.current?f({url:o.current.url,title:o.current.title,itype:"video",scope:r,animation:"slide-in-right"}):f({url:o.list[0].weike[0].url,title:o.list[0].weike[0].title,itype:"video",scope:r,animation:"slide-in-right"})}else if(26==e.data.rtype)f({url:e.data.weike.url,title:e.data.weike.title,itype:"video",scope:r,animation:"slide-in-right"});else if(47==e.data.rtype)f({url:e.data.courseCatalog.review.url,title:e.data.courseCatalog.review.name,itype:"video",scope:r,animation:"slide-in-right"});else{if(ionic.Platform.isIOS())return void l.alert('<div class="center">抱歉，苹果端暂不支持扫码答题，功能在紧急开发中</div>',(function(){}),"知道了");!function(e){var o,i=e.data.diagnosis.hasRecord,t=e.data.diagnosis.examID;i.answerExamID&&1==i.status?1==i.needToSelf?(o={ssk:c.user.childS.ssk,aeid:i.answerExamID,view:"answer"},m.goTifen("main.stuTestSelf",o)):(o={ssk:c.user.childS.ssk,answerExamID:i.answerExamID,type:"parent"},m.goTifen("main.scanReport",o)):(o={ssk:c.user.childS.ssk,examID:t,sceneID:135,type:"parent"},m.goTifen("main.do",o))}(e)}}),(function(t){72==t.status?e.jsonp("user/BingScan",{_host:appConf.host_xt+"r=parents/",code:i},(function(e){o.qrCode=e.data,u.go("main.qrCodeRelate",{code:i}),l.loading.hide()}),(function(e){l.showTip(e.msg),l.loading.hide()})):66==t.status?(l.loading.hide(),l.confirm("<span>您还未购买课程，无法扫描查看辅材课程资源，购买课程学习所有课程</span>",(function(e){3==r.user.childS.schoolTypeID?u.go("main.buyIntroduce",{type:0}):u.go("main.buyIntroduce",{type:1})}),"购买课程","知道了",(function(e){}),!1,!1),$(".popup").css({width:"270px !important"}),$(".popup-title").css({"line-height":"25px"})):(l.loading.hide(),l.showTip(t.msg))}))}console.log(r.user,r.user.childS,"user"),window.cordova?h.scan((function(e){if(0==e.status){var o=e.text;console.log(e,"二维码"),"string"==typeof o?i(o):l.showTip("扫描二维码无效")}}),(function(e){l.showTip(e.msg)})):w.load("https://res.wx.qq.com/open/js/jweixin-1.6.0.js").then((function(){p.jsonp("wechat/GetJsSign",{authUrl:location.href.split("#")[0],_host:appConf.domain_xt+"/index.php?r=parents/"},(function(e){if(e.data){console.log(e);var o=e.data||{},t=o.appId,n=o.nonceStr,s=o.signature,a=o.timestamp;console.log("appId:"+t,"nonceStr:"+n,"signature:"+s,"timestamp:"+a),wx.config({debug:!1,appId:t,timestamp:a,nonceStr:n,signature:s,jsApiList:["scanQRCode"]}),wx.scanQRCode({needResult:1,scanType:["qrCode","barCode"],success:function(e){var o=e.resultStr;console.log(o),o&&i(o)}})}}),(function(e){l.showTip(e.msg)}))}))},r.getTutor=function(e){u.go("main.tutor")},r.goKTModel=function(e){var o=c.user.childS;if(o)if(o.ktinfo)switch(e){case"correctRecord":u.go("main.correctRecord",{uid:o.ktinfo.uid});break;case"homework":u.go("main.homework",{uid:o.ktinfo.uid,schoolTypeID:o.ktinfo.schoolTypeID});break;case"KZHomework":u.go("main.homeworkAll",{uid:o.ktinfo.uid,schoolTypeID:o.ktinfo.schoolTypeID,type:6});break;case"classReview":u.go("main.classReview",{uid:o.ktinfo.uid,schoolTypeID:o.ktinfo.schoolTypeID});break;case"wrongQuestion":u.go("main.wrongQuestion",{uid:o.ktinfo.uid});break;case"examSystem":u.go("main.examList",{uid:o.ktinfo.uid});break;case"studyTrack":u.go("main.stuStudyTrack",{uid:o.ktinfo.uid,schoolTypeID:o.ktinfo.schoolTypeID,name:r.user.childS.name})}else l.showTip("当前孩子没有关联课堂账号！");else l.showTip("请添加孩子")},r.getXTModel=function(e,o){c.user.info.childIndex;if(c.user.childS)switch(e){case 101:break;case 104:u.go("main.xuetang");break;case 105:u.go("main.examination",{type:e,title:o});break;case 102:u.go("main.exerType",{title:o});break;case 103:u.go("main.mockExam",{title:o})}else l.showTip("请添加孩子")},r.toXXKJModel=function(e,o){c.user.info.childIndex;var i=c.user.childS,t={ssk:c.user.childS.ssk,hostSsk:c.user.ssk};if(i)switch(e){case"incorrectExer":m.goXwkongjian("main.incorrectExer",t);break;case"exerRecord":m.goXwkongjian("main.exerRecord",t);break;case"evaluation":m.goXwkongjian("main.evaluation",t);break;case"studentReport":t.answerExamID=o.aeid,t.examID=o.examID,t.title="测评记录报告",139==o.sceneID&&(t.sync="true"),m.goXwkongjian("main.studentReport",t);break;case"course":m.goXwkongjian("main.userRank",t);break;case"courseIndex":m.goXwkongjian("main.courseIndex",t);break;case"checkPoint":m.goXwkongjian("main.checkPoint",t)}else l.showTip("请添加孩子")},r.toTBKC=function(){if(r.currentStatus.joinStat.syncCourse){var e={ssk:c.user.childS.ssk,hostSsk:c.user.ssk};m.goXwkongjian("main.courseIndex",e)}else u.go("main.buyIntroduce",{type:2})},r.goTbj=function(){m.goTbj("tab.main",{ssk:c.user.childS.ssk})},r.goTifen=function(e){m.goTifen(e,{ssk:c.user.childS.ssk})},c.user.childS&&(p.jsonp("syncEvaluation/getUserRecentPracticeStat",{ssk:c.user.childS.ssk},(function(e){r.wrongExam.total=e.data.wrongNum||0,r.examRecords.total=e.data.practiceNum||0}),(function(e){l.showTip(e.msg)})),p.jsonp("syncEvaluation/myPractices",{tabType:"cloudspace",start:0,len:10,ssk:c.user.childS.ssk},(function(e){r.evaluationView.total=e.data.total||0,r.evaluationView.list=e.data.list}),(function(e){l.showTip(e.msg)})),p.jsonp("user/getUserCourseStat",{ssk:c.user.childS.ssk},(function(e){r.currentStatus.joinStat=e.data.joinStat,r.currentStatus.buyStat=e.data.buyStat}),(function(e){l.showTip(e.msg)})),p.jsonp("user/getTestRecordTotal",{ssk:c.user.childS.ssk},(function(e){e.data&&(g.userKeyValue.recordDetail={evaluationDoneTotal:e.data.evaluationDoneTotal||0,reviewDoneTotal:e.data.reviewDoneTotal||0,reviewTotal:e.data.reviewTotal||0},r.recordData.recordDetail=g.userKeyValue.recordDetail)}),(function(e){l.showTip(e.msg)})),p.jsonp("user/getServiceStatus",{serviceID:35},(function(e){0==e.status&&(r.currentStatus.mingshi=e.data.status)}),(function(e){l.showTip(e.msg)}))),r.$on("$ionicSlides.sliderInitialized",(function(e,o){o.slider.slideTo(r.sliderIndex,0),r.slider=o.slider,r.slider.startAutoplay(),console.log(o.slider),console.log(r.slider)})),r.toReport=function(){r.currentStatus.mingshi>0?u.go("main.learningRecord",{uid:c.user.childS.uid}):u.go("main.buyIntroduce365")}}]);